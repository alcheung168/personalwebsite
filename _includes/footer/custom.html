<!-- _includes/footer/custom.html -->

<!-- Sticky Back to Top button -->
<button id="backToTop" class="back-to-top" aria-label="Back to top">â†‘ BACK TO TOP</button>

<script>
(function () {
  var root      = document.documentElement;
  var hero      = document.querySelector('.page__hero--overlay');
  var card      = document.querySelector('.page__hero--overlay .wrapper');
  var seeMore   = document.querySelector('.page__lead .see-more');
  var backBtn   = document.getElementById('backToTop');

  var THRESHOLD      = 10;     // navbar fade trigger (px)
  var PARALLAX_RATIO = 0.35;   // hero moves 35% of scroll

  /* ===== Navbar fade (adds html.nav-scrolled) ===== */
  function updateNavFade() {
    if (window.scrollY > THRESHOLD) {
      root.classList.add('nav-scrolled');
    } else {
      root.classList.remove('nav-scrolled');
    }
  }

  /* ===== Parallax hero scroll ===== */
  function updateParallax() {
    if (!hero) return;
    var offset = Math.round(window.scrollY * PARALLAX_RATIO);
    hero.style.setProperty('--hero-parallax', offset + 'px');
  }

  /* ===== SEE MORE fade + Back-to-Top visibility ===== */
  function updateUI() {
    var y   = Math.max(0, Math.min(window.scrollY, window.innerHeight));
    var vh  = window.innerHeight || 0;

    if (seeMore) {
      var hidden = y > (vh * 0.4);
      seeMore.classList.toggle('see-more-hidden', hidden);
    }

    if (backBtn) {
      backBtn.classList.toggle('show', y > (vh * 0.6));
    }
  }

  /* ===== Smooth scroll to top ===== */
  if (backBtn) {
    backBtn.addEventListener('click', function () {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  }

  /* ===== Helpers ===== */
  function pointerInRect(e, rect) {
    var x = e.clientX, y = e.clientY;
    return x >= rect.left && x <= rect.right && y >= rect.top && y <= rect.bottom;
  }

  /* ===== Hero portrait tilt via CSS vars (pfp.jpg) ===== */
  if (card) {
    card.addEventListener('pointermove', function (e) {
      var rect = card.getBoundingClientRect();
      if (!pointerInRect(e, rect)) return;

      var relX = (e.clientX - rect.left) / rect.width - 0.5;  // -0.5..0.5
      var relY = (e.clientY - rect.top)  / rect.height - 0.5; // -0.5..0.5

      var maxTilt = 12; // deg
      var tiltX = (-relY * maxTilt * 2).toFixed(2);
      var tiltY = ( relX * maxTilt * 2).toFixed(2);

      root.style.setProperty('--tiltX', tiltX + 'deg');
      root.style.setProperty('--tiltY', tiltY + 'deg');
    });

    card.addEventListener('pointerleave', function () {
      root.style.setProperty('--tiltX', '0deg');
      root.style.setProperty('--tiltY', '0deg');
    });
  }

  /* ===== NEW: Generic tilt for any .tilt-img on the site ===== */
  (function setupGenericTiltImages() {
    var MAX_TILT = 8; // degrees
    var tiltImages = document.querySelectorAll('.tilt-img');

    tiltImages.forEach(function (img) {
      img.style.transformOrigin = 'center';
      img.style.transition      = 'transform 0.1s ease';
      img.style.willChange      = 'transform';

      img.addEventListener('mousemove', function (e) {
        var rect = img.getBoundingClientRect();
        var relX = (e.clientX - rect.left) / rect.width - 0.5;  // -0.5..0.5
        var relY = (e.clientY - rect.top)  / rect.height - 0.5; // -0.5..0.5

        var tiltX = (-relY * MAX_TILT * 2).toFixed(2);
        var tiltY = ( relX * MAX_TILT * 2).toFixed(2);

        img.style.transform = 'rotateX(' + tiltX + 'deg) rotateY(' + tiltY + 'deg)';
      });

      img.addEventListener('mouseleave', function () {
        img.style.transform = 'rotateX(0deg) rotateY(0deg)';
      });
    });
  })();

  /* ===== Initial run & scroll hooks ===== */
  updateNavFade();
  updateParallax();
  updateUI();

  window.addEventListener('scroll', function () {
    updateNavFade();
    updateParallax();
    updateUI();
  });
})();
</script>
